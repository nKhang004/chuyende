<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch S·ª≠ ƒêi·ªÉm Danh</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">üì∏ H·ªá Th·ªëng ƒêi·ªÉm Danh</h1>
            <ul class="nav-menu">
                <li><a href="/">Trang ch·ªß</a></li>
                <li><a href="/register">ƒêƒÉng k√Ω</a></li>
                <li><a href="/attendance">ƒêi·ªÉm danh</a></li>
                <li><a href="/history" class="active">L·ªãch s·ª≠</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h2>L·ªãch S·ª≠ ƒêi·ªÉm Danh</h2>

        <div class="filter-section">
            <form id="filterForm" method="GET" action="/history">
                <div class="form-group-inline">
                    <label for="dateFilter">L·ªçc theo ng√†y:</label>
                    <input type="date" id="dateFilter" name="date" value="{{ request.args.get('date', '') }}">
                    <button type="submit" class="btn btn-primary">L·ªçc</button>
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='/history'">
                        X√≥a b·ªô l·ªçc
                    </button>
                </div>
            </form>
        </div>

        <div class="table-container">
            {% if records %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>M√£ SV</th>
                            <th>T√™n sinh vi√™n</th>
                            <th>L·ªõp</th>
                            <th>Th·ªùi gian</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in records %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ record.student_id }}</td>
                            <td>{{ record.name }}</td>
                            <td>{{ record.class or 'N/A' }}</td>
                            <td>{{ record.check_in_time }}</td>
                            <td>
                                <span class="badge badge-success">{{ record.status }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="summary">
                    <p><strong>T·ªïng s·ªë:</strong> {{ records|length }} b·∫£n ghi</p>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üìã</div>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒëi·ªÉm danh</p>
                    <a href="/attendance" class="btn btn-primary">ƒêi·ªÉm danh ngay</a>
                </div>
            {% endif %}
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3>Xu·∫•t d·ªØ li·ªáu</h3>
            <button id="exportExcel" class="btn btn-success">üìä Xu·∫•t Excel</button>
            <button id="exportPDF" class="btn btn-danger">üìÑ Xu·∫•t PDF</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 H·ªá Th·ªëng ƒêi·ªÉm Danh Sinh Vi√™n</p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Set ng√†y hi·ªán t·∫°i l√†m m·∫∑c ƒë·ªãnh
        const dateFilter = document.getElementById('dateFilter');
        if (!dateFilter.value) {
            dateFilter.value = new Date().toISOString().split('T')[0];
        }

        // Export to Excel (simple CSV)
        document.getElementById('exportExcel').addEventListener('click', function() {
            const table = document.querySelector('.data-table');
            if (!table) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t');
                return;
            }

            let csv = [];
            const rows = table.querySelectorAll('tr');

            rows.forEach(row => {
                const cols = row.querySelectorAll('td, th');
                const rowData = [];
                cols.forEach(col => rowData.push(col.textContent));
                csv.push(rowData.join(','));
            });

            const csvContent = csv.join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'lich_su_diem_danh_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Export to PDF (using window.print)
        document.getElementById('exportPDF').addEventListener('click', function() {
            window.print();
        });
    </script>
</body>
</html>